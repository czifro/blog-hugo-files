<!doctype html>
<html lang="en">
<head>
<title>Github commits' emails change</title>
<!-- 2018-06-22 Fri 15:31 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Org-mode">
<meta name="author" content="Stanislav Arnaudov">

<link  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
<style type="text/css">
/* org mode styles on top of twbs */

html {
    position: relative;
    min-height: 100%;
}

body {
    font-size: 18px;
    margin-bottom: 105px;
}

footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 101px;
    background-color: #f5f5f5;
}

footer > div {
    padding: 10px;
}

footer p {
    margin: 0 0 5px;
    text-align: center;
    font-size: 16px;
}

#table-of-contents {
    margin-top: 20px;
    margin-bottom: 20px;
}

blockquote p {
    font-size: 18px;
}

pre {
    font-size: 16px;
}

.footpara {
    display: inline-block;
}

figcaption {
  font-size: 16px;
  color: #666;
  font-style: italic;
  padding-bottom: 15px;
}

/* from twbs docs */

.bs-docs-sidebar.affix {
    position: static;
}
@media (min-width: 768px) {
    .bs-docs-sidebar {
        padding-left: 20px;
    }
}

/* All levels of nav */
.bs-docs-sidebar .nav > li > a {
    display: block;
    padding: 4px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #999;
}
.bs-docs-sidebar .nav > li > a:hover,
.bs-docs-sidebar .nav > li > a:focus {
    padding-left: 19px;
    color: #A1283B;
    text-decoration: none;
    background-color: transparent;
    border-left: 1px solid #A1283B;
}
.bs-docs-sidebar .nav > .active > a,
.bs-docs-sidebar .nav > .active:hover > a,
.bs-docs-sidebar .nav > .active:focus > a {
    padding-left: 18px;
    font-weight: bold;
    color: #A1283B;
    background-color: transparent;
    border-left: 2px solid #A1283B;
}

/* Nav: second level (shown on .active) */
.bs-docs-sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 30px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav > li > a:focus {
    padding-left: 29px;
}
.bs-docs-sidebar .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav > .active:focus > a {
    padding-left: 28px;
    font-weight: 500;
}

/* Nav: third level (shown on .active) */
.bs-docs-sidebar .nav .nav .nav {
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 40px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav .nav > li > a:focus {
    padding-left: 39px;
}
.bs-docs-sidebar .nav .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav .nav > .active:focus > a {
    padding-left: 38px;
    font-weight: 500;
}

/* Show and affix the side nav when space allows it */
@media (min-width: 992px) {
    .bs-docs-sidebar .nav > .active > ul {
        display: block;
    }
    /* Widen the fixed sidebar */
    .bs-docs-sidebar.affix,
    .bs-docs-sidebar.affix-bottom {
        width: 213px;
    }
    .bs-docs-sidebar.affix {
        position: fixed; /* Undo the static from mobile first approach */
        top: 20px;
    }
    .bs-docs-sidebar.affix-bottom {
        position: absolute; /* Undo the static from mobile first approach */
    }
    .bs-docs-sidebar.affix .bs-docs-sidenav,.bs-docs-sidebar.affix-bottom .bs-docs-sidenav {
        margin-top: 0;
        margin-bottom: 0
    }
}
@media (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .bs-docs-sidebar.affix-bottom,
    .bs-docs-sidebar.affix {
        width: 263px;
    }
}
</style>
<script type="text/javascript">
$(function() {
    'use strict';

    $('.bs-docs-sidebar li').first().addClass('active');

    $(document.body).scrollspy({target: '.bs-docs-sidebar'});

    $('.bs-docs-sidebar').affix();
});
</script>
</head>
<body>
<div id="content" class="container">
<div class="row"><div class="col-md-12"><h1 class="title">Github commits' emails change</h1>


<div id="outline-container-sec-" class="outline-2">
<h2 id="sec-">Abstract</h2>
<div class="outline-text-2" id="text-">
<p>
You know that <i>Contributions</i> panel on your <a href="http://github.com/">Github</a> profile page. Let's face it, developers these day take much pride when they can show their consistent work and progress of their own/forked repositories...even when some of their commits are nothing more than a implementations of a single function. Said panel is clear indication to you, future employee or members of your 'coding community' that you are pretty much a big deal with a good work ethic. Imagine in what of pickle of a situation you would be if for some random reason your commits don't show up there. This post addresses the issue of not having proper git configuration(<i>~</i>.gitconfig/) file on your system and commit to github with the wrong email address.
</p>
</div>
</div>

<div id="outline-container-sec-" class="outline-2">
<h2 id="sec-">My problem with github and some contributions in limbo</h2>
<div class="outline-text-2" id="text-">
<p>
So, yeah, I had the problem myself. I was committing things on a regular basis to github and my repositories but only a very small portion of my commits where showing in the <i>Contributions</i> panel. It took me while to notice that and I was kinda freaked about it as I thought that my 'hard work' will forgotten and the future generations would not be able to see it.
<br >
A little research(I literally just click on <a href="https://help.github.com/articles/why-are-my-contributions-not-showing-up-on-my-profile/">Learn how we count contributions</a>) about how github actually counts contributions and I found out that the email address of the commits must match the main email of your github account. Some other hints taken from github page about how contributions are counted:
</p>
<blockquote>
<p>
Commits will appear on your contributions graph if they meet all of the following conditions:
</p>

<p>
-The email address used for the commits is associated with your GitHub account.
-The commits were made in a standalone repository, not a fork.
-The commits were made:
</p>
<ul class="org-ul">
<li>In the repository's default branch (usually master)
</li>
<li>In the gh-pages branch (for repositories with <a href="https://help.github.com/articles/user-organization-and-project-pages/#project-pages-sites">Project Pages</a> sites)
</li>
</ul>
</blockquote>
<p>
The thing is, sometimes I cloned one of my repositories, made some work on it and then committed it pushed it on github, the email address for the commit would be sent to <i>arnaud@localhost.localdomain</i> which is some weird default configuration of debian and absolutely not the address I want to use on github. This commits github to think that commits aren't coming from you.
</p>
</div>
</div>

<div id="outline-container-sec-" class="outline-2">
<h2 id="sec-">Proper github configuration</h2>
<div class="outline-text-2" id="text-">
<p>
In order to avoid the problem for the future, you have two options. You can set your name and email address manually for each repository you are working on. Just go in the repository's folder and set the <i>user.name</i> and <i>user.email</i> fields like:
</p>
<pre class="example">
git config user.name 'Stanislav Arnaudov'
git config user.emial 'stanislav_ts@abv.bg'
</pre>
<p>
This sets the name and the email on a repository 'local' level. After that each commit will have those name and email address. If you want to set global name and email address for your system and not worry about each individual repo, you would have to edit(create if you don't have the file) your ~/.gitconfig file. Somewhere in there you should have something like
</p>
<pre class="example">
[user]
        name = Stanislav Arnaudov
        email = stanislav_ts@abv.bg
</pre>
<p>
This sets the name and email globally and every commit made on your system will have the proper fields. On git hub, you can see the raw path of a commit with  <a href="https://github.com/">https://github.com/</a>&lt;user_name&gt;/&lt;repo&gt;/commit/&lt;commit_id&gt;.patch. On this page you could inspect the commit and see exactly which email address is associated with it.
</p>

<div class="org-src-container">

<pre class="src src-bash">tail ~/.gitconfig
</pre>
</div>
<pre class="example">
			git commit --amend -m \"$(git log -1 --pretty=%B)\n\nCloses #$1.\"; \
		fi \
}; f"


[user]
        name = Stanislav Arnaudov
        email = stanislav_ts@abv.bg
[credential]
	helper = cache
</pre>
</div>
</div>

<div id="outline-container-sec-" class="outline-2">
<h2 id="sec-">Fixing the your repositories</h2>
<div class="outline-text-2" id="text-">
<p>
But of course, so far we've only prevented the problem of occurring in the future. You probably want to know how do we actually fix the previous 'damage'. This section describes that...and my approach of tackling it.
<br >
First, some of my experiments and findings. The thing about git repos - everything is stored in that nifty <i>.git</i> folder. Every delta, every branch, every everything. So, I supposed that if I go there and start changing things, I could probably could change the email address of past commits. If you run <i>grep</i> in your repository
</p>
<pre class="example">
grep -r "arnaud@localhost.localdomain" ./.git
</pre>
<p>
you get all the occurrences of your 'wrong' email in your commits...or everywhere else for that matter. Ok, so if you change those github probably will notice and everything will be OK, right? So, I run <i><a href="https://en.wikipedia.org/wiki/Sed">sed</a></i> in conjunction with <i>find</i> like:
</p>
<pre class="example">
find ./.git/ -type f -exec sed 's/arnaud@scc-wkit-clxa-23-139.scc.kit.edu/stanislav_ts@abv.bg/' -i {} +;
</pre>
<p>
This find every regular file in the <i>.git</i> folder and runs <code>sed 's/arnaud@localhost.localdomain/stanislav_ts@abv.bg/' -i</code> on it. With the expression in the quotation marks <i>sed</i> replaces everything that matches 'arnaud@localhost.localdomain' with 'stanislav_ts@abv.bg'. The <code>-i</code> means "inplace" so be careful when running <i>sed</i> like that because you may break something. So I do that and then push onto github...and nothing happens. The thing is <code>git push</code> the things "in" your repo and kinda is disregarding of changes in <i>.git</i>. In some cases, git may refuse to make the push crying "histories don't match"(or something). In those case one would have to call push as
</p>
<pre class="example">
git push --force
</pre>
<p>
which overwrites 'everything' in the github repo. So I do that and....again, this didn't work. When I expected the commits in the repository on github my profile picture still wasn't there. I am not sure what the reason for that is although I was pretty sure I would change at least <i>something</i> while messing with the <i>.git</i> folder.
<br >
Here I will stop boring you with my "personal experience" and just give you the solution.
</p>
</div>
<div id="outline-container-sec-" class="outline-3">
<h3 id="sec-">The right solution</h3>
<div class="outline-text-3" id="text-">
<p>
After some more research I found <a href="https://help.github.com/articles/changing-author-info/">this help page</a> on github. I guess the problem is actually not uncommon. The page describers the whole process of "re-authoring" your commit history. They even provide a script that could be run in a bare repository(one only for pushing and pulling from) that changes everything. Something to not - the provided script must be given old(wrong) and new(right one) email to re-placed. This is done because while preforming the "hack" on a shared repo where not one but a few developers have commits. Of course you don't really want to overwrite the email of someone else.
<br >
BUT...in my repos I had commits also made from my university's network and the emails of those were completely other beasts. Therefore I change the script a little bit and wrote an extra supplementary script that does absolutely everything. If you want to automate the whole process, copy this:
</p>
<pre class="example">
#!/bin/bash

echo "Cloning repo..."
git clone --bare $1 new_repo
cd ./new_repo
echo "Running reindex script..."
git filter-branch --env-filter '
CORRECT_NAME="&lt;user name&gt;"
CORRECT_EMAIL="&lt;user email&gt;"
export GIT_COMMITTER_NAME="$CORRECT_NAME"
export GIT_COMMITTER_EMAIL="$CORRECT_EMAIL"
export GIT_AUTHOR_NAME="$CORRECT_NAME"
export GIT_AUTHOR_EMAIL="$CORRECT_EMAIL"
' --tag-name-filter cat -- --branches --tags
echo "Hard-pushing to origin..."
git config --global credential.helper cache
git push --force --tags origin 'refs/heads/*'
cd ..
echo "Deleting folder..."
rm -rf new_repo
</pre>
<p>
in a <i>.sh</i> file, adjust the &lt;user_name&gt; and &lt;user email&gt; fields with your name and email and run the script like ./file.sh <a href="https://github/">https://github/</a>&lt;user&gt;/&lt;repo&gt;.git. This will:
</p>
<ol class="org-ol">
<li>Clone the repo in new folder with name new_repo
</li>
<li>Run a slight modification of github's script
</li>
<li>Push the change repo on github(eventually you will be asked to give your username and password)
</li>
<li>Deletes the newly created folder.
</li>
</ol>
<p>
At the end everything is as it was but all of the commits in the repo will have the email that was in the script.
<br >
<i>Note:</i> This will create a file in your home directory with name .git-credentials and it will contain your github username and password. I do this so I can use <code>git config --global credential.helper cache</code> which removes the necessity of typing your name and pass on every commit.(Yes, I know, I should set up the ssh thing, shut up)
<b>Caution:</b> My script changes the committer's emails and names of <span class="underline"><b>ALL</b></span> commits. If you run the script on a repo with several developers. This could potentially and most likely will cause some people to be angry with you...and rightfully so. I mean, you just ruined someone's <i>Contributions</i> panel...how would you like that if done to you.
<br >
</p>

<p>
And there you have it. With your newly acquired knowledge you could transform your <i>Contributions</i> panel form this:
<img src="./images/panel_bad.png" class="img-responsive" alt="panel_bad.png">
to this.
<img src="./images/pane_good.png" class="img-responsive" alt="pane_good.png">
And you know, the ultimate bragging writes are yours!
</p>
</div>
</div>
</div>
</div></div></div>
<footer id="postamble" class="">
<div><p class="date">Date: <span class="timestamp-wrapper"><span class="timestamp">&lt;2018-06-07 Thu&gt;</span></span></p>
<p class="author">Author: Stanislav Arnaudov</p>
<p class="date">Created: 2018-06-22 Fri 15:31</p>
</div>
</footer>
</body>
</html>
